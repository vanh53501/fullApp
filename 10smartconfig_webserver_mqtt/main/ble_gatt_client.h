#ifndef __BLE_GATT_CLIENT_H
#define __BLE_GATT_CLIENT_H

#include <stdint.h>
#include <string.h>
#include <stdbool.h>
#include <stdio.h>
#include "nvs.h"
#include "nvs_flash.h"

#include "esp_bt.h"
#include "esp_gap_ble_api.h"
#include "esp_gattc_api.h"
#include "esp_gatt_defs.h"
#include "esp_bt_main.h"
#include "esp_gatt_common_api.h"
#include "esp_log.h"
#include "freertos/FreeRTOS.h"

#define GATTC_TAG "SMART_GARDEN"

typedef enum {
PROFILE_HUMI_ID  = 0,
PROFILE_TEMP_ID  = 1,
PROFILE_PH_ID    = 2,
PROFILE_EC_ID    = 3,
PROFILE_WP_ID    = 4,
PROFILE_AP_ID    = 5,
PROFILE_LED_ID   = 6
} gattc_profile_inst_t;
#define PROFILE_NUM      7


#define INVALID_HANDLE   0

static const char remote_device_name[] = "Smart Garden";
static bool connect    = false;
static bool get_server = false;

static esp_gattc_char_elem_t *char_elem_result   = NULL;
static esp_gattc_descr_elem_t *descr_elem_result = NULL;

static void esp_gap_cb(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param);
static void esp_gattc_cb(esp_gattc_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gattc_cb_param_t *param);
static void gattc_profile_event_handler(esp_gattc_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gattc_cb_param_t *param,int x);


static esp_bt_uuid_t char_uuid[PROFILE_NUM] = {
    [PROFILE_HUMI_ID] = {
        .len = ESP_UUID_LEN_128,
        .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    },
    [PROFILE_TEMP_ID] = {
        .len = ESP_UUID_LEN_128,
        .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    },
    [PROFILE_PH_ID] = {
        .len = ESP_UUID_LEN_128,
        .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    },
    [PROFILE_EC_ID] = {
        .gattc_cb = gattc_profile_event_handler,
        .gattc_if = ESP_GATT_IF_NONE,
    },
    [PROFILE_WP_ID] = {
        .gattc_cb = gattc_profile_event_handler,
        .gattc_if = ESP_GATT_IF_NONE,
    },
    [PROFILE_AP_ID] = {
        .gattc_cb = gattc_profile_event_handler,
        .gattc_if = ESP_GATT_IF_NONE,
    },
    [PROFILE_LED_ID] = {
        .gattc_cb = gattc_profile_event_handler,
        .gattc_if = ESP_GATT_IF_NONE,
    },
};
static esp_bt_uuid_t service_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x24, 0x12, 0xb5, 0xcb, 0xd4, 0x60, 0x80, 0x0c, 0x15, 0xc3, 0x9b, 0xa9, 0xac, 0x5a, 0x8a, 0xde},
    //.uuid.uuid128 = {0xf4, 0x58, 0x8d, 0xd4, 0x72, 0x81, 0x1c, 0xbe, 0xa7, 0x41, 0x53, 0x9e, 0x3b, 0xc6, 0x05, 0xb3},
};

static esp_bt_uuid_t humi_char_uuid = {
    .len = ESP_UUID_LEN_128,
   .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};

static esp_bt_uuid_t temp_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};

static esp_bt_uuid_t EC_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};

static esp_bt_uuid_t PH_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};

static esp_bt_uuid_t air_pump_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};
#ifndef ADAFRUIT_NEOPIXEL_H
#define ADAFRUIT_NEOPIXEL_H


static esp_bt_uuid_t pump_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};
static esp_bt_uuid_t led_char_uuid = {
    .len = ESP_UUID_LEN_128,
    .uuid.uuid128 = {0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b},
    //.uuid.uuid128 = {0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61},
    //.uuid.uuid128 = {0x9a, 0x5a, 0xdf, 0x7d, 0x87, 0xcc, 0xb4, 0xb6, 0xc0, 0x48, 0xc4, 0xfe, 0x00, 0x72, 0xb4, 0x20},
};

static esp_bt_uuid_t notify_descr_uuid = {
    .len = ESP_UUID_LEN_16,
    .uuid = {.uuid16 = ESP_GATT_UUID_CHAR_CLIENT_CONFIG,},
};

static esp_ble_scan_params_t ble_scan_params = {
    .scan_type              = BLE_SCAN_TYPE_ACTIVE,
    .own_addr_type          = BLE_ADDR_TYPE_PUBLIC,
    .scan_filter_policy     = BLE_SCAN_FILTER_ALLOW_ALL,
    .scan_interval          = 0x50,
    .scan_window            = 0x30,
    .scan_duplicate         = BLE_SCAN_DUPLICATE_DISABLE
};

struct gattc_profile_inst {
    esp_gattc_cb_t gattc_cb;
    uint16_t gattc_if;
    uint16_t app_id;
    uint16_t conn_id;
    uint16_t service_start_handle;
    uint16_t service_end_handle;
    uint16_t char_handle;
    esp_bd_addr_t remote_bda;
};

#endif